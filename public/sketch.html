<html lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.js"></script>
    <script src="javascript/sketch.js"></script>
    <script src="javascript/heap.js"></script>
    <script src="javascript/logic.js"></script>
    

    <link rel="stylesheet" href="sketch.css">
  </head>
  <body>
    <div class="container">
      <div class="title">Draw This: <span id="prompt"></span></div>
      <div id="game">
        <div id="canvas"></div>
        <div id="tools">
          <button id="clearScreen" onclick="clearScreen()"><img src="resources/clear.png"></button>
          <button id="eraser" onclick="equipEraser()"><img src="resources/eraser2.png"></button>
          <button id="pen" onclick="equipPencil()"><img src="resources/pencil2.png"></button>
          <input id="paint" type="color" value="#000000">
        </div>
      </div>
      <div id="submit2">
        <button id="saveDrawing" class="submit" onclick="saveDrawing(givenPrompt)">Download</button>
        <button id="submit" class="submit">Computer Guess</button>
      </div>
    </div>
    <div id="note">Note: If you resize the page, you must reload the page for the canvas to be resized</div>
    <script>
      //list of every prompt to choose from
      let prompts = [
        'axe',
        'baseball bat',
        'bed',
        'bench',
        'bread',
        'canoe',
        'circle',
        'diamond',
        'door',
        'ear',
        'elbow',
        'envelope',
        'fork',
        'hammer',
        'hexagon',
        'hockey stick',
        'ladder',
        'leg',
        'line',
        'lipstick',
        'mountain',
        'ocean',
        'paper clip',
        'pear',
        'pencil',
        'pillow',
        'popsicle',
        'rainbow',
        'screwdriver',
        'see saw',
        'shoe',
        'shorts',
        'shovel',
        'spoon',
        'square',
        'stairs',
        'star',
        'stitches',
        'streetlight',
        'string bean',
        'suitcase',
        'swing set',
        'sword',
        't-shirt',
        'table',
        'tent',
        'triangle',
        'underwear',
        'wine bottle',
        'zigzag'
      ];

      //get a randomized prompt (if one doesnt exist already) and add it to session storage in case the page is reloaded
      let givenPrompt = sessionStorage.getItem("prompt");
      if (givenPrompt == null){
        givenPrompt = prompts[Math.floor(Math.random() * prompts.length)];
        sessionStorage.setItem("prompt", givenPrompt);
      }
      //update the title so the user knows what the prompt is
      document.getElementById("prompt").innerHTML = givenPrompt;

      //when the paint input button is pressed, update the values in the interface
      document.getElementById("paint").oninput = function () {
        let r = parseInt(this.value.substring(1, 3), 16);
        let g = parseInt(this.value.substring(3, 5), 16);
        let b = parseInt(this.value.substring(5, 7), 16);
        changeColor(r, g, b);
      }

      //when the submit button is pressed, run the algorithm and go to the results page to display them
      document.getElementById("submit").onclick = function () {
        //first add the URL to the canvas as a png to the session storage, so that it can be in the html on results page
        let canvas = document.getElementById("defaultCanvas0");
        sessionStorage.setItem("canvasURL", canvas.toDataURL("img/png"));

        let strokes2 = getStrokes();

        // console.log("slopes")
        // console.log(slopes);

        //this is just a test, but this is a 3d array directly from the JSON dataset (and im trying to draw it)
        let dataSetDrawing = [[[6,9,22,32,37,121,196,189,172,158,96,74,40,23,0,9,9],[87,128,179,242,255,223,216,201,116,0,47,59,70,71,65,91,109]]]
        drawAvg(dataSetDrawing);

        // console.log("dataset slopes")
        // console.log(getSlopes(dataSetDrawing))

        // console.log("our slopes")
        // console.log(getSlopes(strokes2))

        //round up/down each coordinate to make it easier to compare to the dataset (whole integers)
        for (let stroke2 of strokes2){
          for (let i = 0; i < stroke2[0].length; i++){
            stroke2[0][i] = Math.floor(stroke2[0][i]);
            stroke2[1][i] = Math.floor(stroke2[1][i]);
          }
        }

        //gets the min and max x and y values for all the points in your drawing
        let xmin = null;
        let xmax = null;
        let ymin = null;
        let ymax = null;
        for (let stroke2 of strokes2){
          for (let i = 0; i < stroke2[0].length; i++){
            let x = stroke2[0][i]
            let y = stroke2[1][i]

            let set = false;

            if (xmin == null) { xmin = x; set = true; }
            if (xmax == null) { xmax = x; set = true; }
            if (ymin == null) { ymin = y; set = true; }
            if (ymax == null) { ymax = y; set = true; }

            if (!set){
              if (xmin > x) xmin = x; set = true;
              if (xmax < x) xmax = x; set = true;
              if (ymin > y) ymin = y; set = true;
              if (ymax < y) ymax = y; set = true;
            }

          }
        }
        //to make the box a perfect square, pick the dimensions based on which direction is traveled further (more x change or y change?)
        if (xmax - xmin > ymax - ymin){
          //TODO: figure out a way to center the box (change ymax and ymin for this if statement)
          ymax = ymin + (xmax - xmin);
        }
        if (xmax - xmin <= ymax - ymin){
          xmax = xmin + (ymax - ymin);
        }
        //draw the perfect square box
        drawBox(xmin, xmax, ymin, ymax)

        drawAvg(strokes2);

        //TODO: scale it downnn
        let strokes3 = getStrokes();
        for (let stroke3 of strokes3){
          for (let i = 0; i < stroke3[0].length; i++){
            stroke3[0][i] = Math.floor(stroke3[0][i]) - xmin;
            stroke3[1][i] = Math.floor(stroke3[1][i]) - ymin;

          }
        }

        drawAvg(strokes3);

    
        console.log("our floored strokes")
        console.log(strokes2)

        console.log("dataset strokes")
        console.log(dataSetDrawing)

        // RUN THE BIG SCARY ALGORITHM HERE AND GET A HEAP
        let heap = compare();

        //temporarily commented out for testing
        // window.location.href = 'results.html';
      }

      function mousePress (pressing) {
        if (pressing){
          startStroke();
        } else {
          endStroke();
        }
      }

      function mouseDown(){
        mousePress(true);
      }
      function mouseUp(){
        mousePress(false);
      }
      
      window.addEventListener("mousedown", mouseDown);
      window.addEventListener("mouseup", mouseUp);

      
      
    </script>
  </body>
</html>